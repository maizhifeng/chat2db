<div class="chat2db">
  <h3>Chat2DB 简易演示</h3>
  
  <div class="query-options">
    <label>
      <input type="checkbox" [(ngModel)]="useNlp">
      使用自然语言处理
    </label>
  </div>
  
  <textarea [(ngModel)]="queryText" placeholder="{{useNlp ? '例如: 显示所有员工' : '例如: SELECT * FROM employees'}}"></textarea>

  <div class="model-selector">
    <label for="model">模型:</label>
    <select id="model" [(ngModel)]="selectedModel">
      <option *ngFor="let m of models" [value]="m">{{m}}</option>
    </select>
    <button (click)="fetchModels()" [disabled]="loadingModels" class="secondary">
      {{loadingModels ? '加载中...' : '刷新模型'}}
    </button>
  </div>
  
  <div class="action-buttons">
    <button (click)="loadModelAndChat()" [disabled]="loading || !selectedModel">加载并发送</button>
    <button (click)="send()" [disabled]="loading">发送</button>
  </div>
  
  <div *ngIf="useNlp && generatedSql" class="results-container">
    <h4>生成的 SQL</h4>
    <pre>{{generatedSql}}</pre>
  </div>
  
  <div *ngIf="loadingMessage" class="loading-message">
    <div class="loading-spinner"></div>
    <span>{{loadingMessage}}</span>
  </div>

  <div *ngIf="sql && !useNlp" class="results-container">
    <h4>执行的 SQL</h4>
    <pre>{{sql}}</pre>
  </div>

  <div *ngIf="results.length" class="results-container">
    <h4>结果（最多 100 条）</h4>
    <table>
      <thead>
        <tr>
          <th *ngFor="let k of (results[0] | keyvalue)">{{k.key}}</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of results">
          <td *ngFor="let v of (r | keyvalue)">{{v.value}}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>